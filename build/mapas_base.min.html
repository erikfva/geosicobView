<script id="tmpl-base-maps-item" type="text/x-tmpl">{% o.forEach(function(item, i){ %}<div class="row thumbnail basemap-thumbnail"><div class="col-xs-10 btn-thumbnail" id="{%=item.id%}" role="button" href="#" onclick='onSelectBaseMap("{%=item.id%}",this)'><img src="{%=item.mapthumbs%}" alt="..." class="pull-left img-circle" width="50" height="50" style="margin-right: 5px"><h4 class="caption">{%=item.lyr_options.title%}</h4></div><div class="col-xs-2">{% if (item.description && item.description != '') { %} <a href="#{%=item.id%}-info" class="lead" data-toggle="collapse"><i class="glyphicon glyphicon-info-sign"></i> </a>{% } %} {% if (item.template && item.template != '') { %} <a href="#{%=item.id%}-config" class="pull-left" data-toggle="collapse"><i class="fa fa-cog fa-2x" aria-hidden="true"></i> </a>{% } %}</div>{% if (item.description && item.description != '') { %}<div class="clearfix"></div><div id="{%=item.id%}-info" class="collapse">{% print(item.description, true); %}</div>{% } %} {% if (item.template && item.template != '') { %}<div class="clearfix"></div><div id="{%=item.id%}-config" class="collapse">{% include(item.template,item); %}</div>{% } %}</div>{% }); %}</script><script type="text/javascript">function renderBaseMapsPanel(e,a){var s=document.getElementById(a);if(void 0!==s){$(s).addClass("basemap container-fluid");var r=tmpl("tmpl-base-maps-item",e);$(s).append(r)}}function onSelectBaseMap(e,a){if($(a).closest(".basemap-thumbnail").hasClass("active")||$(a).hasClass("btn-thumbnail")){var s=loadjsonLayer(window.jsonLayers,e);s&&"function"==typeof s.onSelectFn?s.onSelectFn(a):setBaseMap(e,a)}}function setBaseMapConfig(e,a){map.getLayers().forEach(function(s){"base"==s.getProperties().type&&e==s.get("id")&&s.getSource().getParams&&(s.getSource().updateParams(a),console.log(s.getSource().getParams()))})}function setBaseMap(e,a,s){map.getLayers().forEach(function(a){"base"==a.getProperties().type&&((s||e)==a.get("id")?(a.setZIndex(-1),a.setVisible(!0)):a.setVisible(!1))}),$(a).closest(".basemap").find(".basemap-thumbnail").removeClass("alert-info active"),$(a).closest(".basemap-thumbnail").addClass("alert-info active")}function loadjsonLayer(e,a){if("undefined"==typeof ol)return null;for(var s=0;s<e.length;++s){var r=e[s];if(r.id==a){if(r.loaded)return console.log("ya esta cargado",r),r;var t=null;switch(r.lyr_source.type){case"BingMaps":$.each(["Aerial","Road","AerialWithLabels"],function(e,a){var s=JSON.parse(JSON.stringify(r.lyr_options));s.type="base",s.displayInLayerSwitcher=!1;var t=JSON.parse(JSON.stringify(r.lyr_source));t.imagerySet=a,s.source=new ol.source.BingMaps(t);var i=new ol.layer.Tile(s);i.set("id",r.id+a),i.setVisible(!1),map.addLayer(i)}),r.loaded=!0;break;case"GOOGLE":$.each(["s","m","y","t","p"],function(e,a){var s=JSON.parse(JSON.stringify(r.lyr_options));s.type="base",s.displayInLayerSwitcher=!1;var t=JSON.parse(JSON.stringify(r.lyr_source));t.url+="&lyrs="+a,s.source=new ol.source.XYZ(t);var i=new ol.layer.Tile(s);i.set("id",r.id+a),i.setVisible(!1),map.addLayer(i)}),r.loaded=!0;break;case"OSM":t=r.lyr_options,t.source=new ol.source.OSM;break;case"XYZ":t=r.lyr_options,t.source=new ol.source.XYZ(r.lyr_source);break;case"Sentinel2":$.each(["1_NATURAL_COL0R","4_AGRICULTURE","2_COLOR_INFRARED__VEGETATION_"],function(e,a){var s=JSON.parse(JSON.stringify(r.lyr_options));s.type="base",s.displayInLayerSwitcher=!1;var t=JSON.parse(JSON.stringify(r.lyr_source));t.params.layers=a,s.source=new ol.source.TileWMS(t);var i=new ol.layer.Tile(s);i.set("id",r.id+a),i.setVisible(!1),map.addLayer(i)}),r.loaded=!0}if(null!=t){t.type="base",t.displayInLayerSwitcher=!1;var i=new ol.layer.Tile(t);i.set("id",r.id),i.setVisible(!1),map.addLayer(i)}return r.onSelectFnName&&(r.onSelectFn=new Function("el",r.onSelectFnName+"(el);")),r.loaded=!0,r}}return null}</script><script type="text/javascript">function onSelectBingMaps(a){setBaseMap("lyr_bingmap",a,"lyr_bingmap"+$("#bing-layer-select").val())}</script><script id="tmpl-bingmaps" type="text/x-tmpl"><select id="bing-layer-select" onchange='onSelectBaseMap("lyr_bingmap",this)'><option value="Aerial">Im&aacute;gen satelital</option><option value="AerialWithLabels" selected="selected">Im&aacute;gen con etiquetas</option><option value="Road">Calles</option></select></script><script type="text/javascript">function onSelectGoo(o){setBaseMap("lyr_goo",o,"lyr_goo"+$("#goo-layer-select").val())}</script><script id="tmpl-goo" type="text/x-tmpl"><select id="goo-layer-select" onchange='onSelectBaseMap("lyr_goo",this)'><option value="s">Im&aacute;gen satelital</option><option value="y">Im&aacute;gen con etiquetas</option><option value="m" selected="selected">Mapa de calles</option><option value="t">Terreno</option></select></script><script type="text/javascript">function getSentinelOptions(){return{layers:$("#sentinel2-layer-select").val()+($("#sentinel2-showdate").prop("checked")?",DATE":""),MAXCC:$("#sentinel2-cloud").val()}}function onSelectSentinel(e){setBaseMapConfig("lyr_sentinel"+$("#sentinel2-layer-select").val(),getSentinelOptions()),setBaseMap("lyr_sentinel"+$("#sentinel2-layer-select").val(),e,"lyr_sentinel"+$("#sentinel2-layer-select").val())}</script><script id="tmpl-sentinel" type="text/x-tmpl"><div class="col-sm-12 form-group"><div class="col-sm-8 form-control-static input-sm"><select class="form-control" id="sentinel2-layer-select" onchange='onSelectBaseMap("lyr_sentinel",this)'><option value="1_NATURAL_COL0R" selected="selected">Color Natural</option><option value="2_COLOR_INFRARED__VEGETATION_">Indice de Vegetaci&oacute;n</option><option value="4_AGRICULTURE">Agricultura</option></select></div><div class="text-center col-sm-4 form-control-static input-sm"><i class="fa fa-calendar fa-2x" aria-hidden="true"></i> <span class="yt-uix-checkbox-on-off"><input id="sentinel2-showdate" class="" type="checkbox" onchange='onSelectBaseMap("lyr_sentinel",this)'><label for="sentinel2-showdate" id="sentinel2-showdate-label"><span class="checked">&nbsp;</span> <span class="unchecked"></span> <span class="toggle">&nbsp;</span></label></span></div></div><div class="col-sm-12 text-center"><div class="pull-left"><i class="fa fa-cloud fa-2x" aria-hidden="true"></i> <i class="glyphicon glyphicon-minus-sign" aria-hidden="true"></i></div><span id="sentinel2-cloud-info" class="h4">{%=o.lyr_source.params.MAXCC%}</span><div class="pull-right"><i class="glyphicon glyphicon-plus-sign" aria-hidden="true"></i> <i class="fa fa-cloud fa-2x" aria-hidden="true"></i></div><input id="sentinel2-cloud" name="thumb-roundness" oninput='$("#sentinel2-cloud-info").text(this.value)' onchange='onSelectBaseMap("lyr_sentinel",this)' label="" class="col-xs-4 form-control-static input-sm" type="range" value="{%=o.lyr_source.params.MAXCC%}" min="0" max="100" step="1"></div></script>