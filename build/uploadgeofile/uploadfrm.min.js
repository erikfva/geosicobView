function uploadSHP(a){"function"==typeof a&&$("#dlgUploadSHP").one("hide.bs.modal",function(){var n=$("#modal-result",this).val();n&&a(n)}),$("#dlgUploadSHP").modal("show")}$("#dlgUploadSHP").on("show.bs.modal",function(a){$("li",this).remove(),$("#drop",this).show(),$("#modal-result",this).val("")}),$(function(){function a(a){return"number"!=typeof a?"":a>=1e9?(a/1e9).toFixed(2)+" GB":a>=1e6?(a/1e6).toFixed(2)+" MB":(a/1e3).toFixed(2)+" KB"}var n=$("#upload ul");$("#drop a").click(function(){$(this).parent().find("input").click()}),$("#upload").fileupload({dropZone:$("#drop"),add:function(t,o){$("#drop").hide();var e=$('<li class="working"><div class="col-xs-8">\t<input type="text" value="0" data-width="48" data-height="48" data-fgColor="#0788a5" data-readOnly="1" data-bgColor="#3e4043" /><p></p></div><div class="col-xs-3"><div class="pull-right btn-toolbar">\t<a href="#" class="btn btn-danger"><span class="glyphicon glyphicon-trash"></span></a>\t<a href="#" class="btn btn-primary"><span class="glyphicon glyphicon-upload"></span></a></div></div><div class="clearfix" style="height:75px"></div><div class="message"></div></li>');o.msgboard=e.find(".message"),e.find("p").text(o.files[0].name).append("<i>"+a(o.files[0].size)+"</i>"),o.context=e.appendTo(n),e.find("input").knob(),e.find("a.btn-danger").click(function(){e.hasClass("working")&&void 0!==i&&i.abort(),e.fadeOut(function(){e.remove(),$("#drop").show()})});var i;o.handleError=function(){o.context.addClass("error"),o.msgboard.html('<div class="alert alert-danger alert-dismissible fade in" role="alert">\t<button type="button" class="close" data-dismiss="alert" aria-label="Close">\t    <span aria-hidden="true">&times;</span>\t</button>\t<strong>'+o.msg+"</strong></div>")},e.find("a.btn-primary").click(function(){$(this).fadeOut(),"undefined"!=typeof GEOSICOB_KEY&&$('#upload input[name="session_key"]').val(GEOSICOB_KEY),o.form[0].action=GEOSICOB_URL+"shapefilesadd.php",i=o.submit().fail(function(a,n,t){o.msg=t,o.handleError.call()}).always(function(a,n,t){if("success"===n){if("0"===a.success)return o.msg=a.msg,o.handleError.call(),void e.find("a.btn-primary").fadeIn();$("#upload #modal-result").val(JSON.stringify(a)),$("#dlgUploadSHP .close").click()}})})},progress:function(a,n){var t=parseInt(n.loaded/n.total*100,10);n.context.find("input").val(t).change(),100==t&&(n.context.removeClass("working"),$('<h2 class="text-center text-info"><span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Analizando archivo...</h2>').hide().appendTo(n.msgboard).fadeIn())}}),$(document).on("drop dragover",function(a){a.preventDefault()})});