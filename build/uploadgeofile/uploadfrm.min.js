function uploadSHP(a){"function"==typeof a&&$("#dlgUploadSHP").one("hide.bs.modal",function(){var n=$("#modal-result",this).val();n&&a(n)}),$("#dlgUploadSHP").modal("show")}$("#dlgUploadSHP").on("show.bs.modal",function(a){$("li",this).remove(),$("#drop",this).show(),$("#modal-result",this).val("")}),$(function(){function a(a){return"number"!=typeof a?"":a>=1e9?(a/1e9).toFixed(2)+" GB":a>=1e6?(a/1e6).toFixed(2)+" MB":(a/1e3).toFixed(2)+" KB"}var n=$("#upload ul");$("#drop a").click(function(){$(this).parent().find("input").click()}),$("#upload").fileupload({dropZone:$("#drop"),add:function(t,e){$("#drop").hide();var o=$('<li class="working"><div class="col-xs-8">\t<input type="text" value="0" data-width="48" data-height="48" data-fgColor="#0788a5" data-readOnly="1" data-bgColor="#3e4043" /><p></p></div><div class="col-xs-3"><div class="pull-right btn-toolbar">\t<a href="#" class="btn btn-danger"><span class="glyphicon glyphicon-trash"></span></a>\t<a href="#" class="btn btn-primary"><span class="glyphicon glyphicon-upload"></span></a></div></div><div class="clearfix" style="height:75px"></div><div class="message"></div></li>');e.msgboard=o.find(".message"),o.find("p").text(e.files[0].name).append("<i>"+a(e.files[0].size)+"</i>"),e.context=o.appendTo(n),o.find("input").knob(),o.find("a.btn-danger").click(function(){o.hasClass("working")&&void 0!==i&&i.abort(),o.fadeOut(function(){o.remove(),$("#drop").show()})});var i;e.handleError=function(){e.context.addClass("error"),e.msgboard.html('<div class="alert alert-danger alert-dismissible fade in" role="alert">\t<button type="button" class="close" data-dismiss="alert" aria-label="Close">\t    <span aria-hidden="true">&times;</span>\t</button>\t<strong>'+e.msg+"</strong></div>")},o.find("a.btn-primary").click(function(){$(this).fadeOut(),"undefined"!=typeof GEOSICOB_KEY&&$('#upload input[name="session_key"]').val(GEOSICOB_KEY),i=e.submit().fail(function(a,n,t){e.msg=t,e.handleError.call()}).always(function(a,n,t){if("success"===n){var i=JSON.parse(a);if("0"===i.success)return e.msg=i.msg,e.handleError.call(),void o.find("a.btn-primary").fadeIn();$("#upload #modal-result").val(a),$("#dlgUploadSHP .close").click()}})})},progress:function(a,n){var t=parseInt(n.loaded/n.total*100,10);n.context.find("input").val(t).change(),100==t&&(n.context.removeClass("working"),$('<h2 class="text-center text-info"><span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Analizando archivo...</h2>').hide().appendTo(n.msgboard).fadeIn())}}),$(document).on("drop dragover",function(a){a.preventDefault()})});