<style>.ol-custom-overviewmap,.ol-custom-overviewmap.ol-uncollapsible{bottom:auto;left:auto;right:0;top:45px}.ol-custom-overviewmap:not(.ol-collapsed){border:1px solid #000}.ol-custom-overviewmap .ol-overviewmap-map{border:none;width:380px}@media (max-width:1199px){.ol-custom-overviewmap .ol-overviewmap-map{width:315px}}@media (min-width:768px) and (max-width:990px){.ol-custom-overviewmap .ol-overviewmap-map{width:230px}}@media (min-width:10px) and (max-width:767px){.ol-custom-overviewmap .ol-overviewmap-map{width:270px}}.ol-custom-overviewmap .ol-overviewmap-box{border:5px solid red}.ol-custom-overviewmap:not(.ol-collapsed) button{bottom:auto;left:auto;right:1px;top:1px}#overviewsearch button{display:none}.ol-rotate{top:170px;right:0}.scene-wrap{width:100%;height:245px;overflow:hidden;background-color:#000}.spinner-2{position:absolute;top:95px;left:85px;width:50px;height:60px;text-align:center;font-size:10px;z-index:2}.spinner-2>div{background-color:rgba(255,255,255,.3);height:100%;width:.44em;border-radius:3px;display:inline-block;animation:sk-stretchdelay 1.2s infinite ease-in-out;margin-right:2px}.spinner-2 .rect2{animation-delay:-1.1s}.spinner-2 .rect3{animation-delay:-1s}.spinner-2 .rect4{animation-delay:-.9s}.spinner-2 .rect5{animation-delay:-.8s}@keyframes sk-stretchdelay{0%,100%,40%{transform:scaleY(.4);-webkit-transform:scaleY(.4)}20%{transform:scaleY(1);-webkit-transform:scaleY(1)}}</style><script id="tmpl-landsat8" type="text/x-tmpl"><ul class="nav nav-pills">{% Object.keys(o).forEach(function(key, index) { %}<li class="{% print(index==0?' active ':'');%}"><a data-toggle="pill" href="#search-tab{%=index%}">{%=key%}</a></li>{% }); %}</ul><div class="tab-content">{% Object.keys(o).forEach(function(key, index) { %}<div id="search-tab{%=index%}" class="tab-pane fade {% print(index==0?' in active ':'');%}">{% o[key].forEach(function(item, i){ %}<div class="scene-wrap carousel img-thumbnail"><img class="btn loading collapse img-responsive" src="" onclick="loadLandsat({%=JSON.stringify(item)%}); showLayerList();" data-src="//landsat-pds.s3.amazonaws.com/L8/{%=pad(item.path,3)%}/{%=pad(item.row,3)%}/{%=item.sceneID%}/{%=item.sceneID%}_thumb_small.jpg"> <sup class="text-warning" style="position:absolute;top:10px;left:10px">{%=key%}</sup> <sub class="label" style="position:absolute;top:12px;right:8px">{%=item.acquisitionDate%}</sub><div class="spinner-2"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div></div>{% }); %}</div>{% }); %}</div></script><script type="text/javascript">function groupbyPathRow(e){return e.reduce(function(e,t){var a=""+t.path+pad(t.row,3);return void 0===e.temp[a]&&(e.temp[a]=[]),e.temp[a].push(t),e},{temp:[],out:[]}).temp}function pad(e,t){return e=e.toString(),e.length<t?pad("0"+e,t):e}function loadImage(e,t){var a=new Image,n=e.getAttribute("data-src");a.onload=function(){e.parent?e.parent.replaceChild(a,e):e.src=n,$(e).fadeIn().parent().find(".spinner-2").hide(),t&&t()},a.src=n}function elementInViewport(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.top<=(window.innerHeight||document.documentElement.clientHeight)}function searchLandsat(){if(map.getView().getResolution()>250)return void $("#search .need-zoom").removeClass("hide");$("#search .need-zoom, #search .btn-update").addClass("hide");var extent=ol.proj.transformExtent(map.getView().calculateExtent(map.getSize()),"EPSG:3857","EPSG:4326");if(void 0===document.searchextent&&(document.searchextent=[]),extent.length==document.searchextent.length&&extent.every(function(e,t){return e===document.searchextent[t]}))return!0;document.searchextent=extent;var coordinates="[[["+extent[0]+","+extent[1]+"],["+extent[2]+","+extent[1]+"],["+extent[2]+","+extent[3]+"],["+extent[0]+","+extent[3]+"],["+extent[0]+","+extent[1]+"]]]",fini="2016-01-01",ffin="2017-01-31",params={search:"acquisitionDate:[2016-01-01 TO 2017-01-31] AND dayOrNight:day AND onAmazon:true",shape:'{"type":"Polygon","coordinates":'+coordinates+"}",fields:"browseURL,thumbnail,sceneID,cartURL,cloudCoverFull,acquisitionDate,path,row,sensor,sceneStartTime,sceneStopTime,sunElevation,dayOrNight",page:1,limit:500},srcURL="https://lms.eosda.com/search/landsat8?"+jQuery.param(params);$.ajax({url:srcURL,dataType:"json"}).always(function(){}).done(function(data){data=eval(data),data.results.sort(function(e,t){var a=e.acquisitionDate,n=t.acquisitionDate;return a<n?1:a>n?-1:0});var arr=groupbyPathRow(data.results);document.getElementById("search-result").innerHTML=tmpl("tmpl-landsat8",arr);for(var images=new Array,query=$q("img.loading"),processScroll=function(){for(var e=0;e<images.length;e++)elementInViewport(images[e])&&loadImage(images[e],function(){images.splice(e,e)})},i=0;i<query.length;i++)images.push(query[i]);processScroll(),console.log(arr)})}function loadLandsat(e){if(!map.getLayer(e.sceneID)){var t=new ol.source.XYZ({url:"https://{a-d}-render.eosda.com/landsat/"+e.sceneID+"/PS:B4:B3:B2:B8/{z}/{x}/{y}"}),a=new ol.layer.Tile({id:e.sceneID,title:"Landsat8 "+e.path+"/"+e.row+" ("+e.acquisitionDate+")",description:JSON.stringify(e),source:t});map.addLayer(a)}}var viewMapControl=new ol.View({maxZoom:6,minZoom:6}),lyr_Landsat8Grid=new ol.layer.Tile({source:new ol.source.XYZ({url:"https://api.mapbox.com/styles/v1/erikfva/cizmqkk88001g2rqkgdup16gw/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZXJpa2Z2YSIsImEiOiJjaXprdjBzaWowMGVhMzJydm43MzRscmE0In0.VC7fM1EHl9OqPPZ3fD_Eqg"})}),overviewMapControl=new ol.control.OverviewMap({className:"ol-overviewmap ol-custom-overviewmap",layers:[new ol.layer.Tile({source:new ol.source.OSM({url:"https://{a-c}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=7c352c8ff1244dd8b732e349e0b0fe8d"})}),lyr_Landsat8Grid],collapseLabel:"»",label:"«",collapsed:!0,view:viewMapControl,target:"overviewsearch"});map.addControl(overviewMapControl),map.getView().on(["change:center","change:resolution"],function(e){if(map.getView().getResolution()>250)return $("#search .need-zoom").removeClass("hide"),void $("#search .btn-update").addClass("hide");$("#search .need-zoom").addClass("hide"),$("#search .btn-update").removeClass("hide")}),$(function(){window.$q=function(e,t){if(document.querySelectorAll)t=document.querySelectorAll(e);else{var a=document,n=a.styleSheets[0]||a.createStyleSheet();n.addRule(e,"f:b");for(var r=a.all,o=0,i=[],s=r.length;o<s;o++)r[o].currentStyle.f&&i.push(r[o]);n.removeRule(0),t=i}return t},_has=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}})</script>